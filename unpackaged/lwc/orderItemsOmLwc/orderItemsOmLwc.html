<template>
    <div class={orderItemsBoxClass}>
        <div class="slds-size_6-of-6 slds-large-size_6-of-6">
            <div class="slds-grid slds-wrap sticky-header slds-theme_shade">
                <div class="slds-size_6-of-6 slds-large-size_6-of-6 slds-p-around_xx-small">
                    <div class="slds-grid slds-wrap slds-grid_vertical-align-end">
                        <template if:false={isMobile}>
                            <div class="slds-size_6-of-6">
                                <template if:true={order.Pricebook2.Show_Discount_OM__c}>
                                    <lightning-input  class="slds-float_left" value={discountInput}
                                        placeholder={labels.enterDiscount} min="0" max={maxDiscount} data-index={index}
                                        onchange={handleChangeDiscountInput} variant="label-hidden" >
                                    </lightning-input>
                                    
                                    <lightning-button variant="brand" label={labels.applyCustomDiscount}
                                        icon-name="utility:check" disabled={isDiscountSelected}
                                        class="slds-m-left_xx-small slds-float_left" onclick={setCustomDiscount}>
                                    </lightning-button>
                                </template>
                                <template if:false={isContractSelected}>
                                    <lightning-button variant="brand" label={contractDiscountLabel}
                                        disabled={isOrderItemsSelected}
                                        icon-name="utility:contract" class="slds-m-left_xx-small slds-float_left"
                                        onclick={setContractDiscount}>
                                    </lightning-button>
                                </template>
                            </div>
                        </template>
                        <template if:true={isMobile}>
                            <template if:true={order.Pricebook2.Show_Discount_OM__c}>
                                <div class="slds-size_6-of-6 slds-grid slds-grid_vertical-align-end">
                                    <div class="slds-form-element slds-col slds-grow slds-medium-size_4-of-8 slds-large-size_3-of-8">
                                        <div>
                                            <label class="slds-form-element__label" for="slider-id-01">Discount
                                                %</label>
                                            <div class="slds-form-element__control">
                                                <div class="slds-slider">
                                                    <input id="slider-id-01" type="range" class="slds-slider__range"
                                                        min=0 max={maxDiscount} step=1 data-index={index}
                                                        oninput={handleChangeDiscountInput} title="Discount"
                                                        value={discountInput} />
                                                    <span class="slds-slider__value"
                                                        aria-hidden="true">{discountInput}</span> 
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <template if:true={order.Pricebook2.Show_Discount_OM__c}>
                                        <div class="slds-hide_large slds-col slds-grow-none">
                                            <lightning-button-icon variant="brand" label={labels.applyCustomDiscount}
                                                icon-name="utility:check" disabled={isDiscountSelected}
                                                class="slds-m-right_xx-small" onclick={setCustomDiscount}></lightning-button-icon>
                                        </div>
                                        <div class="slds-show_large slds-col slds-grow-none">
                                            <lightning-button variant="brand" label={labels.applyCustomDiscount}
                                                icon-name="utility:check" disabled={isDiscountSelected}
                                                class="slds-m-right_xx-small" onclick={setCustomDiscount}>
                                            </lightning-button>
                                        </div>
                                    </template>
                                    <template if:false={isContractSelected}>
                                        <div class="slds-hide_medium slds-col slds-grow-none">
                                            <lightning-button variant="brand" label={contractDiscountLabelCompact}
                                                disabled={isOrderItemsSelected}
                                                icon-name="utility:contract" class="slds-m-right_xx-small"
                                                onclick={setContractDiscount}>
                                            </lightning-button>
                                        </div>
                                        <div class="slds-show_medium slds-col slds-grow-none">
                                            <lightning-button variant="brand" label={contractDiscountLabel}
                                                disabled={isOrderItemsSelected}
                                                icon-name="utility:contract" class="slds-m-right_xx-small"
                                                onclick={setContractDiscount}>
                                            </lightning-button>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </template>
                        <div class="slds-size_6-of-6 slds-p-around_xxx-small slds-m-top_x-small slds-grid_vertical-align-center">
                            <div class={selectAllCheckboxClass}>
                                <template if:true={isMobile}>
                                    <!-- <lightning-input type="checkbox-button" id="select-all-checkbox-button"
                                        name="select-all-checkbox-button" label="select-all-checkbox-button"
                                        checked={selectAll} disabled={enableSelection} variant="label-hidden"
                                        onchange={handleSelectAllChange} class="slds-float_left">
                                    </lightning-input> -->
                                    <template if:true={order.Pricebook2.Show_Discount_OM__c}>
                                        <template if:true={selectAll}>
                                            <lightning-button-icon title="Select all" alternative-text="select all" size="large"
                                                disabled={enableSelection} icon-name="utility:multi_select_checkbox" variant="bare"
                                                onclick={handleSelectAllChange} class="slds-float_left">
                                            </lightning-button-icon>
                                        </template>
                                        <template if:false={selectAll}>
                                            <lightning-button-icon title="Select all" alternative-text="select all" size="large"
                                                disabled={enableSelection} icon-name="utility:layers" variant="bare"
                                                onclick={handleSelectAllChange} class="slds-float_left">
                                            </lightning-button-icon>
                                        </template>
                                    </template>
                                    <div for="select-all-checkbox-button" class="slds-float_left slds-m-top_small compact-label slds-checkbox_button__label">
                                        <span class="slds-text-title_caps">{orderItemsCounter}</span>
                                    </div>
                                </template>
                                <template if:false={isMobile}>
                                    <template if:true={order.Pricebook2.Show_Discount_OM__c}>
                                        <lightning-input type="checkbox" id="select-all-checkbox"
                                            name="select-all-checkbox" label="select-all-checkbox"
                                            checked={selectAll} disabled={enableSelection} variant="label-hidden"
                                            onchange={handleSelectAllChange} class="slds-float_left">
                                        </lightning-input>
                                    </template>
                                    <label for="select-all-checkbox" class="slds-checkbox__label compact-label">
                                        <span class="slds-text-title_caps">{orderItemsCounter}</span>
                                    </label>
                                </template>
                                <!-- <div class="slds-form-element__control">
                                    <div class="slds-checkbox">
                                        <input type="checkbox" name="select-all" id="checkbox-unique-id-73"
                                            value="checkbox-unique-id-73" checked={selectAll} disabled={enableSelection}
                                            onchange={handleSelectAllChange} data-index={index} />
                                        <label class="slds-checkbox__label compact-label" for="checkbox-unique-id-73">
                                            <span class="slds-checkbox_faux"></span>
                                            <span class="slds-text-title_caps">{totalOrderItems}
                                                Order Items</span>
                                        </label>
                                    </div>
                                </div> -->
                            </div>
                        </div>
                        <template if:true={paginationTalet}>
                            <div class="slds-size_2-of-6 slds-large-size_2-of-6 slds-p-vertical_xxx-small">
                                <lightning-button label={labels.previous} icon-name="utility:chevronleft"
                                    onclick={handlePrevious} disabled={showFirstButton} class="slds-m-left_xx-small">
                                </lightning-button>
                            </div>
                            <div class="slds-size_2-of-6 slds-large-size_2-of-6 slds-p-vertical_xxx-small">
                                <div class="slds-align_absolute-center">{pageNumber} / {getTotalPages}</div>
                            </div>
                            <div class="slds-size_2-of-6 slds-large-size_2-of-6 slds-p-vertical_xxx-small">
                                <lightning-button label={labels.next} class="slds-float_right slds-m-right_xx-small"
                                    icon-name="utility:chevronright" icon-position="right" onclick={handleNext}
                                    disabled={showLastButton}>
                                </lightning-button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            <template if:true={orderItems}>
                <div class={orderItemsInnerBoxClass}>
                    <div class="slds-grid slds-wrap">
                        <template for:each={orderItems} for:item="orderItem" for:index="index">
                            <div class="slds-size_2-of-2 slds-large-size_2-of-2 slds-p-around_xxx-small" key={key}>
                                <article class="slds-card slds-p-around_xx-small" key={key}>
                                    <lightning-tile label={orderItem.Name} href={orderItem.Url} data-index={index}
                                        actions={orderItemTileActions} type="media" target="_blank"
                                        onactiontriggered={handleOrderItemTileAction} class="slds-card">
                                        <template if:true={order.Pricebook2.Show_Discount_OM__c}>
                                            <span slot="media">
                                                <template if:true={isMobile}>
                                                    <lightning-input type="checkbox-button" data-index={index}
                                                        variant="label-hidden" checked={orderItem.isSelected}
                                                        disabled={enableSelection} onchange={handleSelectChange}>
                                                    </lightning-input>
                                                </template>
                                                <template if:false={isMobile}>
                                                    <lightning-input type="checkbox" data-index={index}
                                                        variant="label-hidden" checked={orderItem.isSelected}
                                                        disabled={enableSelection} onchange={handleSelectChange}>
                                                    </lightning-input>
                                                </template>
                                            </span>
                                        </template>
                                        <div class="slds-hide_medium">
                                            <!--div class="slds-region_narrow m-top-negative"-->
                                            <div class="slds-region_narrow slds-m-top-negative">
                                                <template if:true={orderItem.LocalProductDescription__c}>
                                                    <!-- <template if:true={isMobile}> -->
                                                        <div class="slds-text-body_small slds-truncate slds-text-color_weak slds-size_10-of-12">
                                                            {orderItem.LocalProductDescription__c}
                                                        </div>
                                                    <!-- </template> -->
                                                </template>
                                                
                                                <dl class="slds-dl_horizontal">
                                                    <dt class="slds-dl_horizontal__label">
                                                        <p class="slds-truncate">Article Number:</p>
                                                    </dt>
                                                    <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                                        {orderItem.Article__c}</dd>

                                                    <dt class="slds-dl_horizontal__label">
                                                        <p class="slds-truncate">{orderItemQuantityLabel}:</p>
                                                    </dt>
                                                    <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                                        {orderItem.Quantity}</dd>

                                                    <template if:false={order.Pricebook2.ShowPricingfromMicroServiceOM__c}>
                                                        <template if:true={order.Pricebook2.Show_Price_OM__c}>
                                                            <dt class="slds-dl_horizontal__label">
                                                                <p class="slds-truncate">{orderItemUnitPriceLabel}:</p>
                                                            </dt>
                                                            <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                                                {orderItem.UnitPrice} {orderItem.Currency}</dd>
                                                        </template>                                                        
                                                    </template>

                                                    
                                                    
                                                    <template if:true={order.Pricebook2.ShowPricingfromMicroServiceOM__c}>
                                                        <dt class="slds-dl_horizontal__label">
                                                            <p class="slds-truncate">{orderItemRetailPriceLabel}:</p>
                                                        </dt>
                                                        <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                                            {orderItem.AXRetailPrice__c} {orderItem.Currency}</dd>

                                                        <dt class="slds-dl_horizontal__label">
                                                            <p class="slds-truncate">{orderItemUnitPriceLabel}:</p>
                                                        </dt>
                                                        <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                                            {orderItem.UnitPrice} {orderItem.Currency} ({orderItem.AXDiscount__c}  %)</dd>
                                                    </template>
                                                    
                                                    <template if:true={order.Pricebook2.Show_Discount_OM__c}>
                                                        <dt class="slds-dl_horizontal__label">
                                                            <p class="slds-truncate">{orderItemDiscountLabel}:
                                                            </p>
                                                        </dt>
                                                        <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                                            {orderItem.Discount_Percent__c}%</dd>
                                                    </template>

                                                    <template if:true={order.Pricebook2.ShowPricingfromMicroServiceOM__c}>
                                                            <dt class="slds-dl_horizontal__label">
                                                                <p class="slds-truncate"><b>{orderItemTotalLineItemPriceLabel}:</b></p>
                                                            </dt>
                                                            <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                                            <b>{orderItem.Total_Line_Item_Price__c} {orderItem.Currency}</b> </dd>
                                                    </template>

                                                    <template if:true={order.Pricebook2.Show_FOC_OM__c}>
                                                        <template if:true={orderItem.Free_of_Charge_Delivery__c}>
                                                            <dt class="slds-dl_horizontal__label">
                                                                <p class="slds-truncate">{orderItemFOCLabel}:</p>
                                                            </dt>
                                                            <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                                                {orderItem.Free_of_Charge_Delivery__c}</dd>
                                                        </template>
                                                    </template>
                                                </dl>
                                            </div>
                                        </div>
                                        <div class="slds-show_medium">
                                            <div class={marginTopNegativeClass}>
                                                <template if:true={orderItem.LocalProductDescription__c}>
                                                <!-- <template if:true={isMobile}> -->
                                                    <div class="slds-text-body_small slds-truncate slds-text-color_weak">
                                                        {orderItem.LocalProductDescription__c}
                                                    </div>
                                                <!-- </template> -->
                                                
                                                </template>
                                                <ul class="slds-list_horizontal slds-has-dividers_right">
                                                    <li class="slds-item">{orderItem.Article__c}</li>
                                                    
                                                    <li class="slds-item">{orderItemQuantityLabel}: {orderItem.Quantity}</li>
                                                    <template if:false={order.Pricebook2.ShowPricingfromMicroServiceOM__c}>
                                                        <template if:true={order.Pricebook2.Show_Price_OM__c}>
                                                            <li class="slds-item">{orderItemUnitPriceLabel}: {orderItem.UnitPrice} {orderItem.Currency}
                                                            </li>
                                                        </template>                                                        
                                                    </template>
                                                    
                                                    <!--only for AX pricebooks create label -->
                                                    <template if:true={order.Pricebook2.ShowPricingfromMicroServiceOM__c}>
                                                        <li class="slds-item">{orderItemRetailPriceLabel}: {orderItem.AXRetailPrice__c} {orderItem.Currency} 
                                                        </li>
                                                        <li class="slds-item">{orderItemUnitPriceLabel}: {orderItem.UnitPrice} {orderItem.Currency} ({orderItem.AXDiscount__c}  %)
                                                        </li>
                                                    </template>
                                                    
                                                    
                                                    <template if:true={order.Pricebook2.Show_Discount_OM__c}>
                                                        <li class="slds-item">{orderItemDiscountLabel}: {orderItem.Discount_Percent__c}% 
                                                        </li>
                                                    </template>
                                                    <template if:true={order.Pricebook2.Show_Price_OM__c}>
                                                        <li class="slds-item"> <b>{orderItemTotalLineItemPriceLabel}: {orderItem.Total_Line_Item_Price__c} {orderItem.Currency} </b>
                                                        </li>
                                                    </template>
                                                    
                                                    <template if:true={order.Pricebook2.Show_FOC_OM__c}>
                                                        <template if:true={orderItem.Free_of_Charge_Delivery__c}>
                                                            <li class="slds-item">{orderItemFOCLabel}:
                                                                {orderItem.Free_of_Charge_Delivery__c}
                                                            </li>
                                                        </template>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </lightning-tile>
                                </article>
                            </div>
                        </template>
                    </div>
                </div>
                <template if:true={pagination}>
                    <div class="slds-grid slds-wrap slds-theme_shade sticky-footer">
                        <div class="slds-size_2-of-6 slds-large-size_2-of-6 slds-p-vertical_xxx-small">
                            <lightning-button label={labels.previous} icon-name="utility:chevronleft"
                                onclick={handlePrevious} disabled={showFirstButton}>
                            </lightning-button>
                        </div>
                        <div class="slds-size_2-of-6 slds-large-size_2-of-6 slds-p-vertical_xxx-small">
                            <div class="slds-align_absolute-center">{pageNumber} / {getTotalPages}</div>
                        </div>
                        <div class="slds-size_2-of-6 slds-large-size_2-of-6 slds-p-vertical_xxx-small">
                            <lightning-button label={labels.next} class="slds-float_right"
                                icon-name="utility:chevronright" icon-position="right" onclick={handleNext}
                                disabled={showLastButton}>
                            </lightning-button>
                        </div>
                    </div>
                </template>
            </template>
            <template if:true={loading}>
                <lightning-spinner alternative-text="Loading"></lightning-spinner>
            </template>
            <template if:true={itemToUpdate}>
                <c-update-order-item-om-lwc onorderitemupdated={handleOrderItemUpdated} order={order}
                    item-to-update={itemToUpdate} tile-action={currentTileAction}></c-update-order-item-om-lwc>
            </template>
        </div>
    </div>
</template>